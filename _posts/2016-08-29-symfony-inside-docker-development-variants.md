---
layout: post
title: "Symfony внутри Docker (варианты разработки в Docker-контейнере)"
---
После нескольких месяцев разработки Symfony-проекта были опробованы два варианта разработки в Docker-контейнере. Первый вариант заключается в подключении директории с кодом проекта в виде раздела (volume). Второй вариант требует пересборки образа контейнера после каждого изменения кода проекта.

Оба варианта я рассмотрю более детально в отдельных статьях, а сейчас лишь хочу привести краткое резюме обоих вариантов.

## Подключение директории с кодом как раздела в Docker-контейнере

Плюсы:

* Изменения кода сразу отображаются в контейнере (прямо как в vagrant'е и даже быстрее чем в vagrant'е).
* Не требуется делать какие-либо дополнительные действия, чтобы увидеть результат изменения кода.

Минусы:

* Так как директория с кодом подключена как раздел (volume), то файлы кэша и другие файлы создаваемые внутри директории с кодом проекта будут иметь владельца от имени которого запущен php-процесс в контейнере, и это скорее всего будет root. А это означает, что вам придётся немного поплясать с бубном, чтобы решить эту проблему, что весьма муторно.
* Абсолютные пути. Так как директория с кодом, скорее всего, монтируется в директорию с путём отличным от пути монтируемой директории, то тут возникает проблема со всё тем же кэшом. Если выполнить прогрев кэша на вашей основной системе, то в кэш запишется абсолютный путь к директории с кодом проекта на основной системе. Из-за этого при выполнении кода внутри контейнера будет получена ошибка из разряда "не могу найти файл ../var/cache/...". Касательно файлов кэша решение есть, и оно будет описано в отдельной статье.

## Пересборка образа контейнера после каждого изменения

Плюсы:

* Более близкий к реальности вариант. Так как сборка образа и запуск контейнера очень похожи на релиз в продакшен, то тут больше шансов отловить проблему с процессом деплоя кода ещё до её обнаружения в продакшене.

Минусы:

* Нужно лезть во внутрь контейнера, чтобы поглядеть логи или другие файлы, которые создаются в локальной файловой системе в процессе работы приложения.
* Нет возможности воспользоваться генерацией кода внутри контейнера, так как файлы не реплицируются на основную систему. Но это решаемо, если обеспечить условия для запуска генераторов кода на основной системе.

На этом пока что всё. В следующих статьях постараюсь осветить более детально оба вышеизложенных варианта.